---
title: "Mini-Project 2"
author: "Zoya and Ruth"
date: "March 20, 2019"
output:
  html_document:
    code_folding: hide
---

##Voter turnout for House of Representative candidates, as a national proportion

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
```

```{r message = FALSE, warning=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

```{r message = FALSE, warning=FALSE}

#Get data for primary votes per candidate, candidate office and candidate state in one table
table1 <- candidates %>%
  full_join(house_elections, by = c("cand_id" = "fec_id")) %>%
  filter(cand_office == "H") %>%
  select(cand_id,cand_name,cand_state,primary_votes,party) %>%
  filter(!is.na(primary_votes))
#note that we filtered out all folks running for House, who had missing data for primary votes
#originally 4160 candidates
#missing data brought it down to 2157
```

```{r message=FALSE, warning=FALSE}
#create table with total primary votes per state
table2 <- table1 %>%
  group_by(cand_state) %>%
  summarise(total_state_vote = sum(primary_votes))
```

```{r}
#Importing state population from excel
state_population <- read.csv("state_population.csv")
```

```{r}
population_data <- state_population %>%
  rename(cand_state=table.with.row.headers.in.column.A.and.column.headers.in.rows.3.through.4...leading.dots.indicate.sub.parts., "pop_2011"= X, "pop_2012"=X.1) %>%
  mutate(avg_pop= (pop_2011 + pop_2012)/2)

```

```{r}

#Joining population_data and table2
table3<-population_data %>%
  left_join(table2, by= "cand_state")
```


```{r}

#Proportions
final_table <- table3 %>%
  mutate(proportion= total_state_vote/avg_pop)
```

```{r}
#FUNCTION-WRITING

state_turnout <- function(prop_arg) {
  final_table %>%
    mutate(proportion= total_state_vote/avg_pop) %>%
    filter(proportion>prop_arg) %>%
    ggplot(aes(x = cand_state, y = proportion)) +
    geom_col(fill = "purple", alpha = 0.5) + scale_y_continuous(labels=scales::percent)
}

state_turnout(0.12)

```


#Data Visualization
```{r}
graph1<- ggplot(data = final_table, aes(x=cand_state, y= proportion)) +
  geom_col(fill="purple", alpha= 0.5)

graph1 +
  scale_y_continuous(labels=scales::percent)
```


```{r}
#r wordcountaddin::word_count()
```

blog:
House of Rep. candidates from each state received a proportion of vote within the state. DC candidates received over 60% of state vote, implying that 40% of population is either not registered to vote, is not of voting age or decided not to cast a vote. The data graphic shows voter turnout per state, and that all candidates have very small voting populations within their state whose vote they are fighting to gain.

